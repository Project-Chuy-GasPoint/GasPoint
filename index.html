<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GasPoint - Cooking Gas Locator</title>

<!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">

<!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

<!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" 
  rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" 
  crossorigin="anonymous">

<!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" 
  integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</head>
<body>

<h1 class="page-title">GasPoint – Cooking Gas Locator</h1>

<div class="container">

    <div class="search-box">
        <input id="locationSearch" placeholder="Enter barangay">
        <button onclick="searchLocation()">Search</button>
    </div>

    <div id="map"></div>
</div>

<script>
document.getElementById("map").style.height = "600px";

// Base Layers
const street = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", { 
    attribution: "&copy; OpenStreetMap contributors" 
});

const satellite = L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", 
    { attribution: "Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics, GIS User Community" }
);


const map = L.map("map", { center: [8.3646, 124.8651], zoom: 13, layers: [street] });


L.control.layers(
    { "OpenStreetMap": street, "Satellite": satellite },
    null,
    { collapsed: false }
).addTo(map);

let gasStores = [];
let markers = []; 

fetch("gaspoint-data.json")
.then(r => r.json())
.then(data => {
    gasStores = data;
    gasStores.forEach(store => {

        let popupHtml = "<b>" + store.title + "</b><br>" +
                        store.description +
                        (store.contact ? "<br><b>Contact:</b> " + store.contact : "");

        if (store.image) {
            popupHtml += `<br><img src="${store.image}" width="150">`;
        }

        const gasIcon = L.icon({
            iconUrl: "images/red lpg.png",
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
        });

        const blueIcon = L.icon({
            iconUrl: "images/blue lpg.png",
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
        });

        let title = store.title.toLowerCase();
        let useIcon = gasIcon;

        if (title.includes("phoenix") || title.includes("gd lpg") || title.includes("kris") ||
            title.includes("apex") || title.includes("petron")) {
            useIcon = blueIcon;
        }

        const marker = L.marker([store.lat, store.lng], { icon: useIcon }).bindPopup(popupHtml);
        marker.type = (useIcon === blueIcon) ? "blue" : "red";
        marker.addTo(map);
        markers.push(marker);
    });
});


const filterControl = L.control({ position: 'topright' });

filterControl.onAdd = function(map) {
    const div = L.DomUtil.create('div', 'filter-box');
    div.innerHTML = `
        <label><input type="checkbox" id="showBlue" checked> Blue LPG</label><br>
        <label><input type="checkbox" id="showRed" checked> Red LPG</label>
    `;

    L.DomEvent.disableClickPropagation(div);

    div.querySelector('#showBlue').addEventListener('change', updateMarkers);
    div.querySelector('#showRed').addEventListener('change', updateMarkers);
    return div;
};

filterControl.addTo(map);

function updateMarkers() {
    const showBlue = document.getElementById("showBlue").checked;
    const showRed = document.getElementById("showRed").checked;

    markers.forEach(marker => {
        const onMap = map.hasLayer(marker);
        if ((marker.type === "blue" && showBlue) || (marker.type === "red" && showRed)) {
            if (!onMap) marker.addTo(map);
        } else {
            if (onMap) map.removeLayer(marker);
        }
    });
}

const knownLocations = {
    "damilag": [8.3503, 124.8121],
    "alae": [8.4208119, 124.8133793],
    "manolo": [8.3646, 124.8651],
    "agusan":[8.3263, 124.8086],
    "lunocan":[8.4143, 124.8231],
    "san miguel":[8.3890, 124.8332]
};

function searchLocation() {
    const q = document.getElementById("locationSearch").value.toLowerCase();
    if (!knownLocations[q]) return;
    map.setView(knownLocations[q], 15);
}
</script>

</body>
</html>
